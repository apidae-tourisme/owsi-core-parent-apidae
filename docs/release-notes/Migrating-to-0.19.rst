.. _migration_0.19:

Migrating to 0.19
=================

This guide aims at helping OWSI-Core users migrate an application based on OWSI-Core 0.18 to OWSI-Core 0.19.

In order to migrate from an older version of OWSI-Core, please refer to :ref:`migration_0.18` first.

.. danger:: The 0.19 version has a known bug (potential NPE). Please, do **not** use this version and bump to :ref:`0.20 <migration_0.20>` instead (actually, yopu can bump directly to :ref:`0.21 <migration_0.21>`).

New features
------------

Force removal of lock if it originates from the same server
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Sometimes, there is an error at the removal of the lock. The lock removes and prevents further processing.
With this patch, the server can detect it is the one which created the lock in the first place.

Thus it decides to remove it and process the new task. This should allow for remaining locks to be properly removed by the owning server in the time, preventing locking issues.

Catch RuntimeException when processing a task
~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Most of the time the `RuntimeException` is generated by *infinispan* not able to acquire or release a lock due to resource exhaustion on any of the servers being part of the infinispan cluster.
With this patch, this type of error will be catched, preventing the death of the associated `Thread`.

In addition, the error is logged for further investigation, and the abandonned task is put again at the end of the queue, allowing for another try.

.. important:: **Potential risk**: A task causing issues systematically would be processed over again and again, which could cause an excessive overhead on the servers. This should be carefully monitored.

